# AGENT.md: Руководство для ИИ-ассистента

Этот документ предназначен для инструктажа больших языковых моделей (LLM) и ИИ-ассистентов по работе с проектом BuddyBot.

## 1. Суть проекта

**BuddyBot** — это комплексная система для корпоративного онбординга новых сотрудников. Основное взаимодействие с пользователем происходит через Telegram-бота и связанное с ним мини-приложение (Web App).

**Ключевые концепции:**

*   **Потоки (Flows)**: Шаблоны обучающих программ, создаваемые администраторами.
*   **Назначения (Assignments)**: Привязка пользователя к конкретному потоку с установкой дедлайнов.
*   **Бадди (Buddy)**: Наставник, который курирует прохождение потока своим подопечным.
*   **Снапшоты (Snapshots)**: Когда поток назначается пользователю, система создает полную, неизменяемую копию (снапшот) всего его содержимого. Пользователь взаимодействует именно со снапшотом, что гарантирует, что изменения в оригинальном потоке не затронут тех, кто уже проходит обучение. **Это ключевая особенность архитектуры.**
*   **Компоненты (Components)**: Атомарные единицы контента (статьи, тесты, задания), из которых состоят потоки.

## 2. Архитектура и стек технологий

*   **Тип проекта**: Монорепозиторий под управлением **Turborepo**.
*   **Язык**: **TypeScript** на всех уровнях.
*   **Основной API**: **GraphQL**.
*   **Фреймворк API**: Используется `graphql-yoga`.
*   **База данных**: **PostgreSQL**.
*   **ORM**: **Prisma**. Схема находится в `packages/database/prisma/schema.prisma`.
*   **Кеширование/Очереди**: **Redis**.
*   **Архитектурный паттерн (`packages/api`)**: Гексагональная архитектура (Clean Architecture).
    *   `src/core`: Ядро бизнес-логики. Не зависит от внешних фреймворков.
        *   `entities`: Определения доменных сущностей.
        *   `repositories`: Интерфейсы для доступа к данным.
        *   `services`: Оркестрация бизнес-логики.
        *   `usecases`: Конкретные сценарии использования.
    *   `src/infrastructure`: Реализация внешних зависимостей.
        *   `database`: Реализация репозиториев с помощью Prisma, управление миграциями.
        *   `external`: Клиенты для сторонних API (Telegram, Email и т.д.).
    *   `src/schema`: Слой GraphQL (то, что видит клиент).
        *   `types`: Определения объектов GraphQL.
        *   `queries`, `mutations`, `subscriptions`: Резолверы.

## 3. Правила работы с кодом

*   **Следование спецификации**: Всегда сверяйтесь с файлом `Спецификация2.html`. Он является единственным источником правды для API и доменных моделей. Не упрощайте модели, если это противоречит спецификации.
*   **Комментирование**: Ожидается подробное комментирование кода. Используйте JSDoc для всех функций, типов и сложных участков логики. Комментарии должны объяснять *почему* код написан именно так, а не *что* он делает.
*   **Единообразие**: Соблюдайте существующий стиль кода. Используйте линтеры и форматтеры, настроенные в проекте.
*   **Импорты**: Используйте абсолютные пути (aliases), если они настроены в `tsconfig.json`, для импортов внутри пакета.
*   **Неизменяемость**: Придерживайтесь принципов функционального программирования и иммутабельности, где это применимо, особенно в `core` слое.

## 4. Предпочтения пользователя (меня)

*   **Язык общения**: Русский.
*   **Уровень экспертизы**: Я являюсь экспертом в программировании. Ваши ответы должны быть технически глубокими и точными. Не предлагайте упрощенных решений, если они компрометируют архитектуру или требования.
*   **Формат ответов**:
    *   Будьте проактивны. Если вы видите проблему, предложите решение.
    *   Четко структурируйте свои планы и действия.
    *   При внесении изменений в код, сначала объясните, что и почему вы собираетесь делать.
*   **Подход к задачам**: Ожидается глубокий анализ проблемы. Прежде чем писать код, убедитесь, что вы полностью поняли задачу, архитектуру и возможные побочные эффекты. 